2025-08-14 12:38:48,186 - INFO - === 测试环境初始化完成 ===
2025-08-14 12:38:48,186 - INFO - 测试日志将保存至：F:\project\Lilith\Test\2025-8-14-database-test\test_log_20250814_123848.txt
2025-08-14 12:38:48,186 - INFO - 测试数据库将保存至：F:\project\Lilith\Test\2025-8-14-database-test\test_chat_memory.db
2025-08-14 12:38:48,187 - INFO - 
=== 1. 初始化数据库连接 ===
2025-08-14 12:38:48,404 - INFO - ✅ 数据库连接成功，表结构初始化完成
2025-08-14 12:38:48,404 - INFO - 生成测试用户ID：test_user_367d7e38
2025-08-14 12:38:48,404 - INFO - 
=== 2. 测试添加用户 ===
2025-08-14 12:38:48,482 - INFO - ✅ 添加新用户成功（数据库写入：users表新增记录）
2025-08-14 12:38:48,483 - INFO - ✅ 重复用户ID拦截成功（未写入数据库）
2025-08-14 12:38:48,483 - INFO - 
=== 3. 测试用户存在性检查 ===
2025-08-14 12:38:48,483 - INFO - ✅ 存在用户检测成功（查询users表验证）
2025-08-14 12:38:48,484 - INFO - ✅ 不存在用户检测成功（查询users表验证）
2025-08-14 12:38:48,484 - INFO - 
=== 4. 测试用户身份验证 ===
2025-08-14 12:38:48,484 - INFO - ✅ 正确密码验证成功（查询users表：user_id和password_hash匹配）
2025-08-14 12:38:48,485 - INFO - ✅ 错误密码验证拦截成功（密码哈希不匹配）
2025-08-14 12:38:48,485 - INFO - 
=== 5. 测试保存聊天消息 ===
2025-08-14 12:38:48,554 - INFO - ✅ 聊天消息保存成功（数据库写入：chat_history表新增记录，内容：你好，这是一条测试消息）
2025-08-14 12:38:48,555 - INFO - 
=== 6. 测试获取聊天历史 ===
2025-08-14 12:38:48,555 - INFO - ✅ 聊天历史查询成功（从chat_history表读取1条记录）
2025-08-14 12:38:48,555 - INFO - 
=== 7. 测试保存用户总结 ===
2025-08-14 12:38:48,646 - INFO - ✅ 用户总结保存成功（数据库更新：users表user_summary字段设为'这是测试用户的性格总结：喜欢测试功能'）
2025-08-14 12:38:48,647 - INFO - ✅ 不存在用户的总结拦截成功（未更新数据库）
2025-08-14 12:38:48,647 - INFO - 
=== 8. 测试保存记忆 ===
2025-08-14 12:38:48,712 - INFO - ✅ 记忆保存成功（数据库写入：memories表新增记录，内容：测试记忆：用户在2025年8月进行了功能测试）
2025-08-14 12:38:48,713 - INFO - ✅ 记忆内容验证成功（从memories表查询确认）
2025-08-14 12:38:48,713 - INFO - ✅ 不存在用户的记忆拦截成功（未写入数据库）
2025-08-14 12:38:48,713 - INFO - 
🎉 所有测试通过！数据库功能正常
2025-08-14 12:38:48,713 - INFO - 测试日志已保存至：F:\project\Lilith\Test\2025-8-14-database-test\test_log_20250814_123848.txt
2025-08-14 12:38:48,713 - INFO - 测试数据库已保存至：F:\project\Lilith\Test\2025-8-14-database-test\test_chat_memory.db
2025-08-14 12:38:48,713 - INFO - 
=== 测试结束 ===
